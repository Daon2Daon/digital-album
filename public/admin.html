<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì - ë””ì§€í„¸ ì•¡ì</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #f3f4f6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            color: #1f2937;
        }
        
        .section {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #374151;
        }
        
        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        
        .upload-area.dragover {
            border-color: #3b82f6;
            background: #dbeafe;
        }
        
        #fileInput {
            display: none;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ì´ë¯¸ì§€ ê·¸ë¦¬ë“œ */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .image-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
        }
        
        .image-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        
        .image-card-body {
            padding: 10px;
        }
        
        .image-card-title {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .image-card-actions {
            display: flex;
            gap: 8px;
        }
        
        /* ì„¤ì • í¼ */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #374151;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        /* ìƒíƒœ ë©”ì‹œì§€ */
        .message {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }
        
        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        
        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ë””ì§€í„¸ ì•¡ì ê´€ë¦¬ì</h1>
            <p style="color: #6b7280; margin-top: 8px;">ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ì„¤ì • ê´€ë¦¬</p>
        </div>
        
        <!-- ìƒíƒœ ë©”ì‹œì§€ -->
        <div id="message" class="message"></div>
        
        <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
        <div class="section">
            <h2>ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
            <div class="upload-area" id="uploadArea">
                <p style="font-size: 16px; margin-bottom: 10px;">ğŸ“ í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</p>
                <p style="font-size: 12px; color: #6b7280;">JPG, PNG íŒŒì¼ë§Œ ê°€ëŠ¥ (ìµœëŒ€ 10MB)</p>
                <input type="file" id="fileInput" accept="image/jpeg,image/jpg,image/png" multiple>
            </div>
            
            <div class="loading" id="uploadLoading">
                <p>ì—…ë¡œë“œ ì¤‘...</p>
            </div>
        </div>
        
        <!-- ì´ë¯¸ì§€ ëª©ë¡ -->
        <div class="section">
            <h2>ì´ë¯¸ì§€ ëª©ë¡ (<span id="imageCount">0</span>)</h2>
            
            <div class="loading active" id="listLoading">
                <p>ë¡œë”© ì¤‘...</p>
            </div>
            
            <div class="image-grid" id="imageGrid"></div>
        </div>
        
        <!-- ì„¤ì • -->
        <div class="section">
            <h2>ìŠ¬ë¼ì´ë“œì‡¼ ì„¤ì •</h2>
            
            <form id="settingsForm">
                <div class="form-group">
                    <label>ìŠ¬ë¼ì´ë“œ ì‹œê°„ (ì´ˆ)</label>
                    <input type="number" id="slideDuration" min="1" max="60" value="10">
                </div>
                
                <div class="form-group">
                    <label>ì „í™˜ íš¨ê³¼</label>
                    <select id="transitionEffect">
                        <option value="fade">Fade</option>
                        <option value="none">ì—†ìŒ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ì „í™˜ ì†ë„ (ì´ˆ)</label>
                    <input type="number" id="transitionSpeed" min="0.1" max="5" step="0.1" value="1">
                </div>
                
                <div class="form-group">
                    <label>í‘œì‹œ ëª¨ë“œ</label>
                    <select id="displayMode">
                        <option value="cover">ì „ì²´ í™”ë©´ ì±„ìš°ê¸° (ê¶Œì¥)</option>
                        <option value="contain">ì´ë¯¸ì§€ ì „ì²´ ë³´ê¸° (ë¹„ìœ¨ ìœ ì§€)</option>
                    </select>
                    <p style="font-size: 12px; color: #6b7280; margin-top: 4px;">
                        â€¢ ì „ì²´ í™”ë©´ ì±„ìš°ê¸°: ì´ë¯¸ì§€ê°€ í™”ë©´ì„ ê½‰ ì±„ì›ë‹ˆë‹¤ (ì¼ë¶€ ì˜ë¦´ ìˆ˜ ìˆìŒ)<br>
                        â€¢ ì´ë¯¸ì§€ ì „ì²´ ë³´ê¸°: ì´ë¯¸ì§€ ì „ì²´ê°€ ë³´ì´ë©° ê²€ì€ ì—¬ë°±ì´ ìƒê¸¸ ìˆ˜ ìˆìŒ
                    </p>
                </div>
                
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="randomOrder">
                        <span>ì´ë¯¸ì§€ ëœë¤ ìˆœì„œë¡œ í‘œì‹œ</span>
                    </label>
                    <p style="font-size: 12px; color: #6b7280; margin-top: 4px;">
                        ì²´í¬í•˜ë©´ ì´ë¯¸ì§€ê°€ ëœë¤ ìˆœì„œë¡œ í‘œì‹œë©ë‹ˆë‹¤. (ìƒˆë¡œê³ ì¹¨ ì‹œë§ˆë‹¤ ìˆœì„œ ë³€ê²½)
                    </p>
                </div>
                
                <button type="submit" class="btn btn-primary" id="saveButton">ì„¤ì • ì €ì¥</button>
            </form>
        </div>
    </div>
    
    <script>
        const API_URL = window.location.origin;
        
        // DOM ìš”ì†Œ
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadLoading = document.getElementById('uploadLoading');
        const listLoading = document.getElementById('listLoading');
        const imageGrid = document.getElementById('imageGrid');
        const imageCount = document.getElementById('imageCount');
        const message = document.getElementById('message');
        const settingsForm = document.getElementById('settingsForm');
        
        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, type = 'success') {
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
            setTimeout(() => {
                message.style.display = 'none';
            }, 5000);
        }
        
        // ì´ë¯¸ì§€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadImages() {
            try {
                const res = await fetch(`${API_URL}/api/admin/images`);
                const data = await res.json();
                
                if (data.success) {
                    displayImages(data.images);
                    listLoading.classList.remove('active');
                }
            } catch (error) {
                console.error('Failed to load images:', error);
                showMessage('ì´ë¯¸ì§€ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ì´ë¯¸ì§€ í‘œì‹œ
        function displayImages(images) {
            imageCount.textContent = images.length;
            imageGrid.innerHTML = '';
            
            if (images.length === 0) {
                imageGrid.innerHTML = '<p style="color: #6b7280;">ì—…ë¡œë“œëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            images.forEach(img => {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.innerHTML = `
                    <img src="${img.url}" alt="${img.originalName}">
                    <div class="image-card-body">
                        <div class="image-card-title" title="${img.originalName}">${img.originalName}</div>
                        <div class="image-card-actions">
                            <button class="btn btn-danger" onclick="deleteImage(${img.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
                imageGrid.appendChild(card);
            });
        }
        
        // ì´ë¯¸ì§€ ì—…ë¡œë“œ
        async function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                uploadLoading.classList.add('active');
                
                const res = await fetch(`${API_URL}/api/admin/upload`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage(`${file.name} ì—…ë¡œë“œ ì„±ê³µ!`);
                    loadImages();
                } else {
                    showMessage(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Upload error:', error);
                showMessage('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            } finally {
                uploadLoading.classList.remove('active');
            }
        }
        
        // ì´ë¯¸ì§€ ì‚­ì œ
        async function deleteImage(id) {
            if (!confirm('ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                const res = await fetch(`${API_URL}/api/admin/images/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showMessage('ì´ë¯¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadImages();
                } else {
                    showMessage(`ì‚­ì œ ì‹¤íŒ¨: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Delete error:', error);
                showMessage('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadSettings() {
            try {
                const res = await fetch(`${API_URL}/api/admin/settings`);
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('slideDuration').value = data.settings.slideDuration / 1000;
                    document.getElementById('transitionEffect').value = data.settings.transitionEffect;
                    document.getElementById('transitionSpeed').value = data.settings.transitionSpeed / 1000;
                    document.getElementById('displayMode').value = data.settings.displayMode || 'cover';
                    document.getElementById('randomOrder').checked = data.settings.randomOrder || false;
                }
            } catch (error) {
                console.error('Failed to load settings:', error);
            }
        }
        
        // ì„¤ì • ì €ì¥
        async function saveSettings(e) {
            e.preventDefault();
            
            const saveButton = document.getElementById('saveButton');
            const originalText = saveButton.textContent;
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½ (ë¡œë”© í‘œì‹œ)
            saveButton.disabled = true;
            saveButton.textContent = 'ì €ì¥ ì¤‘...';
            saveButton.style.opacity = '0.7';
            
            const settings = {
                slideDuration: parseInt(document.getElementById('slideDuration').value) * 1000,
                transitionEffect: document.getElementById('transitionEffect').value,
                transitionSpeed: parseFloat(document.getElementById('transitionSpeed').value) * 1000,
                displayMode: document.getElementById('displayMode').value,
                randomOrder: document.getElementById('randomOrder').checked
            };
            
            try {
                const res = await fetch(`${API_URL}/api/admin/settings`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                const data = await res.json();
                
                if (data.success) {
                    // ì„±ê³µ ì‹œ ë²„íŠ¼ì„ ë…¹ìƒ‰ìœ¼ë¡œ ë³€ê²½
                    saveButton.style.background = '#10b981';
                    saveButton.textContent = 'âœ“ ì €ì¥ ì™„ë£Œ!';
                    showMessage('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    // 2ì´ˆ í›„ ì›ë˜ ìƒíƒœë¡œ ë³µêµ¬
                    setTimeout(() => {
                        saveButton.disabled = false;
                        saveButton.textContent = originalText;
                        saveButton.style.background = '';
                        saveButton.style.opacity = '';
                    }, 2000);
                } else {
                    // ì‹¤íŒ¨ ì‹œ
                    saveButton.disabled = false;
                    saveButton.textContent = originalText;
                    saveButton.style.opacity = '';
                    showMessage(`ì €ì¥ ì‹¤íŒ¨: ${data.error}`, 'error');
                }
            } catch (error) {
                console.error('Save error:', error);
                saveButton.disabled = false;
                saveButton.textContent = originalText;
                saveButton.style.opacity = '';
                showMessage('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        uploadArea.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            files.forEach(uploadFile);
            e.target.value = '';
        });
        
        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            files.forEach(uploadFile);
        });
        
        settingsForm.addEventListener('submit', saveSettings);
        
        // ì „ì—­ í•¨ìˆ˜ (HTMLì—ì„œ í˜¸ì¶œ)
        window.deleteImage = deleteImage;
        
        // ì´ˆê¸°í™”
        loadImages();
        loadSettings();
    </script>
</body>
</html>

